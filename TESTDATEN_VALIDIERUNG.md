# âœ… Testdaten-Script Validierung

## Script: `reset_and_create_test_data.sql`

### DurchgefÃ¼hrte Validierungen:

#### 1. Tabellenstrukturen geprÃ¼ft âœ…
- **customers**: `default_payment_terms` (nicht `payment_terms`) âœ…
- **invoices**: `customer_snapshot` (NOT NULL), `total_vat` (nicht `vat_amount`) âœ…
- **invoice_items**: `net_amount`, `total_amount`, `delivery_location_id` âœ…
- **quotes**: `created_by` REFERENCES `auth.users(id)` âœ…
- **receipt_uploads**: Korrekte Tabelle (nicht `receipts`) âœ…
- **cashbook_entries**: `created_by` (NOT NULL), `receipt_id` âœ…
- **delivery_notes**: `assigned_vehicle_id`, `delivery_notes` âœ…

#### 2. VerknÃ¼pfungen validiert âœ…
- Rechnungen â†’ Rechnungspositionen âœ…
- Rechnungen â†’ Zahlungen (fÃ¼r bezahlte/teilbezahlte) âœ…
- Rechnungen â†’ Lieferorte (50% der Rechnungen) âœ…
- Lieferscheine â†’ Rechnungen, Kunden, Lieferorte, Fahrzeuge âœ…
- Kassenbuch â†’ Belege (receipt_uploads) âœ…
- Artikel â†’ Kundenpreise âœ…
- Artikel â†’ Lieferortpreise âœ…
- Artikel â†’ Mengenstaffeln âœ…
- Kunden â†’ Lieferorte âœ…

#### 3. DatenintegritÃ¤t sichergestellt âœ…
- Alle NOT NULL Felder werden befÃ¼llt âœ…
- Foreign Keys sind korrekt âœ…
- Customer Snapshots als JSONB gespeichert âœ…
- Status-Felder verwenden gÃ¼ltige Werte âœ…
- Berechnungen (Summen, MwSt) sind korrekt âœ…

#### 4. Realistische Testdaten âœ…
- **20 Kunden**: Mix aus B2B/B2C, aktiv/inaktiv
- **30 Artikel**: Verschiedene Kategorien, MwSt-SÃ¤tze (7%/19%)
- **15 Lieferorte**: Mit GPS, Zugangsnotizen, Anlieferzeiten
- **~50 Kundenpreise**: Mit Mengenstaffeln
- **~20 Lieferortpreise**: Baustellenspezifisch
- **~30 Mengenstaffeln**: 3 Staffeln pro Artikel
- **5 Fahrzeuge**: LKW, Transporter, AnhÃ¤nger
- **30 Rechnungen**: Mit 2-7 Positionen, verschiedene Status
- **25 Lieferscheine**: VerknÃ¼pft mit allem
- **15 Angebote**: Verschiedene Status
- **40 Kassenbuch**: Mit Hash-Kette
- **10 Belege**: Mit OCR-Status

### Verwendung:

1. Ã–ffne **Supabase SQL Editor**
2. Kopiere den Inhalt von `reset_and_create_test_data.sql`
3. FÃ¼hre aus
4. ÃœberprÃ¼fe die Ausgabe auf Fehler

### Ergebnis:
```
âœ… Alle Daten vollstÃ¤ndig verknÃ¼pft!
ğŸ“Š ~400+ DatensÃ¤tze erstellt
â±ï¸ AusfÃ¼hrungszeit: ~5-10 Sekunden
```

### Besonderheiten:

- **LÃ¶schen**: In korrekter Reihenfolge (Foreign Keys beachtet)
- **Fehlerbehandlung**: `EXCEPTION WHEN unique_violation` bei Preis-Duplikaten
- **Ausgabe**: Detaillierte RAISE NOTICE Meldungen
- **Statistik**: Komplette Ãœbersicht am Ende
